---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data
The data is loaded using a simple csv read. The preprocessing only concerns converting the date from a string type.
```{r}
activity <- read.csv("activity.csv", stringsAsFactors = FALSE)
activity$date <- as.Date(strptime(activity$date, "%Y-%m-%d")) 
```

## What is mean total number of steps taken per day?
The total number of steps per day can be calculated by aggregating the steps by date. A list is given below.
```{r}
steps.per.day <- aggregate(activity$steps, by = list(Date = activity$date), FUN = sum)
steps.per.day
```

The mean number of steps per day is then calculated by applying the mean function, disregarding NA values.
```{r}
hist(steps.per.day$x, breaks = 16, xlab = "Total steps per day", main = "Total steps per day")
mean(steps.per.day$x, na.rm = TRUE)
median(steps.per.day$x, na.rm = TRUE)
```
As can be seen, the mean and the median are quite close, and both are somewhat over 10000 steps per day.

## What is the average daily activity pattern?
The average daily pattern can be discovered by aggregating the number of steps by 5 minute interval. Again, missing values have been ignored. 
```{r}
steps.per.interval <- aggregate(activity$steps, by = list(Interval = activity$interval), FUN = mean, na.rm = TRUE)
plot(y = steps.per.interval$x, 
     x = steps.per.interval$Interval, 
     type = "l", 
     xlab = "Interval", 
     ylab = "Mean number of steps", 
     main = "Mean amount of steps per 5 minute interval")
steps.per.interval[which.max(steps.per.interval$x),]$Interval
```
The resulting plot demonstrates, that most steps are made between 8:35AM and 8:40AM. 

## Imputing missing values
A total of 2304 values are missing in the dataset. 
```{r}
sum(is.na(activity$steps))
```

In the further analysis, all missing data points were replaced by the mean value for the given interval, over the entire data set. The following code has been run to achieve this:
```{r}
activity.no.na <- activity
missing.entries <- is.na(activity$steps)
missing.intervals <- activity.no.na[is.na(activity$steps),]$interval
myfunc <- function(x) {steps.per.interval[steps.per.interval$Interval == x, "x"]}
missing.steps <- sapply(missing.intervals, myfunc)
activity.no.na[is.na(activity$steps),]$steps <- missing.steps
steps.per.day.no.na <- aggregate(activity.no.na$steps, by = list(Date = activity.no.na$date), FUN = sum)
```

The metrics for the resulting data set resemble the metrics for the original set quite closely: 
```{r}
hist(steps.per.day.no.na$x, breaks = 16, xlab = "Total steps per day", main = "Total steps per day")
mean(steps.per.day.no.na$x, na.rm = TRUE)
median(steps.per.day.no.na$x, na.rm = TRUE)
```
As can be seen, the median number of steps in the adjusted data set is equal to the mean number of steps.  

## Are there differences in activity patterns between weekdays and weekends?
In order to compare activity patterns in weekdays and weekends, a new factor is created for the activity data set. An aggregate is taken by 5 minute interval, and by the factors weekday/weekend.   
```{r}
Sys.setlocale("LC_TIME", "English")
activity.no.na$in.weekend <- as.factor(weekdays(activity.no.na$date) %in% c("Saturday", "Sunday"))
levels(activity.no.na$in.weekend) <- c("Weekday","Weekend")
steps.per.interval.no.na <- aggregate(activity.no.na$steps, 
                                by = list(Interval = activity.no.na$interval, 
                                          In.Weekend = activity.no.na$in.weekend), 
                                FUN = mean, 
                                na.rm = TRUE)
```

The following graphs compare the activity patterns between weekdays and weekends. It can be seen that:  

* In weekends, the test person seems to wake up later than on weekdays.  
* In weekdays, steps during commuting hours are higher.  
* In weekends, steps outside commuting hours are usually somewhat higher.  

```{r warning = FALSE}
library(ggplot2)
g <- ggplot(data = steps.per.interval.no.na, aes(x = Interval, y = x))
g + geom_point() + 
    facet_grid(In.Weekend~.) +
    ylab("Steps") +
    ggtitle("Mean amount of steps per 5 minute interval")
```
